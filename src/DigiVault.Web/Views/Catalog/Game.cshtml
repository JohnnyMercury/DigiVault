@model List<DigiVault.Core.Entities.Product>
@using DigiVault.Core.Entities
@{
    var gameName = ViewBag.GameName as string ?? "–ò–≥—Ä–∞";
    var gameSlug = ViewBag.GameSlug as string ?? "";
    ViewData["Title"] = $"{gameName} - –ö—É–ø–∏—Ç—å –≤–∞–ª—é—Ç—É";

    // –ü–æ–ª—É—á–∞–µ–º –∏–≥—Ä—É –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
    var dbGame = ViewBag.Game as Game;
    var sidebarGames = ViewBag.AllGames as List<Game> ?? new List<Game>();

    // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∏–∑ –±–∞–∑—ã - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë –¥–∞–Ω–Ω—ã–µ, –∏–Ω–∞—á–µ fallback –Ω–∞ hardcoded
    var gameInfo = dbGame != null
        ? new { Currency = dbGame.Currency, CurrencyShort = dbGame.CurrencyShort, Icon = dbGame.Icon, Color = dbGame.Color, Gradient = dbGame.Gradient, ImageUrl = dbGame.ImageUrl }
        : gameSlug.ToLower() switch {
            "fortnite" => new { Currency = "V-Bucks", CurrencyShort = "V-Bucks", Icon = "üéÆ", Color = "#2d5a87", Gradient = "linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%)", ImageUrl = (string?)null },
            "roblox" => new { Currency = "Robux", CurrencyShort = "Robux", Icon = "üé≤", Color = "#e74c3c", Gradient = "linear-gradient(135deg, #c4281c 0%, #e74c3c 100%)", ImageUrl = (string?)null },
            "pubg" => new { Currency = "Unknown Cash", CurrencyShort = "UC", Icon = "üî´", Color = "#e67e22", Gradient = "linear-gradient(135deg, #f39c12 0%, #e67e22 100%)", ImageUrl = (string?)null },
            "genshin" => new { Currency = "Genesis Crystals", CurrencyShort = "Crystals", Icon = "‚öîÔ∏è", Color = "#8b5cf6", Gradient = "linear-gradient(135deg, #5a3e7a 0%, #8b5cf6 100%)", ImageUrl = (string?)null },
            "mobilelegends" => new { Currency = "Diamonds", CurrencyShort = "Diamonds", Icon = "üíé", Color = "#3949ab", Gradient = "linear-gradient(135deg, #1a237e 0%, #3949ab 100%)", ImageUrl = (string?)null },
            "honkai" => new { Currency = "Oneiric Shards", CurrencyShort = "Shards", Icon = "üåü", Color = "#6366f1", Gradient = "linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%)", ImageUrl = (string?)null },
            _ => new { Currency = "–í–∞–ª—é—Ç–∞", CurrencyShort = "–í–∞–ª—é—Ç–∞", Icon = "üéÆ", Color = "#667eea", Gradient = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)", ImageUrl = (string?)null }
        };

    // Check game types
    var isMobileLegends = gameSlug.ToLower() == "mobilelegends";
    var isGenshin = gameSlug.ToLower() == "genshin";
    var isHonkai = gameSlug.ToLower() == "honkai";
    var isRoblox = gameSlug.ToLower() == "roblox";
    var isFortnite = gameSlug.ToLower() == "fortnite";

    // Fortnite V-Bucks products (exactly like kupikod.com)
    var fortniteProducts = new[] {
        new { Amount = "200", Bonus = "", TotalUC = "200 V-Bucks", Price = 109, OldPrice = 109, Discount = 0 },
        new { Amount = "300", Bonus = "", TotalUC = "300 V-Bucks", Price = 162, OldPrice = 162, Discount = 0 },
        new { Amount = "500", Bonus = "", TotalUC = "500 V-Bucks", Price = 273, OldPrice = 273, Discount = 0 },
        new { Amount = "800", Bonus = "", TotalUC = "800 V-Bucks", Price = 412, OldPrice = 412, Discount = 0 },
        new { Amount = "1000", Bonus = "", TotalUC = "1 000 V-Bucks", Price = 559, OldPrice = 559, Discount = 0 },
        new { Amount = "1200", Bonus = "", TotalUC = "1 200 V-Bucks", Price = 594, OldPrice = 594, Discount = 0 },
        new { Amount = "1300", Bonus = "", TotalUC = "1 300 V-Bucks", Price = 644, OldPrice = 644, Discount = 0 },
        new { Amount = "1500", Bonus = "", TotalUC = "1 500 V-Bucks", Price = 727, OldPrice = 727, Discount = 0 },
        new { Amount = "1600", Bonus = "", TotalUC = "1 600 V-Bucks", Price = 780, OldPrice = 780, Discount = 0 },
        new { Amount = "1800", Bonus = "", TotalUC = "1 800 V-Bucks", Price = 854, OldPrice = 854, Discount = 0 },
        new { Amount = "1900", Bonus = "", TotalUC = "1 900 V-Bucks", Price = 897, OldPrice = 897, Discount = 0 },
        new { Amount = "2000", Bonus = "", TotalUC = "2 000 V-Bucks", Price = 941, OldPrice = 941, Discount = 0 },
        new { Amount = "2100", Bonus = "", TotalUC = "2 100 V-Bucks", Price = 965, OldPrice = 965, Discount = 0 },
        new { Amount = "2400", Bonus = "", TotalUC = "2 400 V-Bucks", Price = 1097, OldPrice = 1097, Discount = 0 },
        new { Amount = "2600", Bonus = "", TotalUC = "2 600 V-Bucks", Price = 1175, OldPrice = 1175, Discount = 0 },
        new { Amount = "2800", Bonus = "", TotalUC = "2 800 V-Bucks", Price = 1444, OldPrice = 1444, Discount = 0 },
        new { Amount = "3800", Bonus = "", TotalUC = "3 800 V-Bucks", Price = 1589, OldPrice = 1589, Discount = 0 },
        new { Amount = "5000", Bonus = "", TotalUC = "5 000 V-Bucks", Price = 2264, OldPrice = 2264, Discount = 0 },
        new { Amount = "5600", Bonus = "", TotalUC = "5 600 V-Bucks", Price = 2533, OldPrice = 2533, Discount = 0 },
        new { Amount = "6000", Bonus = "", TotalUC = "6 000 V-Bucks", Price = 2729, OldPrice = 2729, Discount = 0 },
        new { Amount = "7800", Bonus = "", TotalUC = "7 800 V-Bucks", Price = 3350, OldPrice = 3350, Discount = 0 },
        new { Amount = "10000", Bonus = "", TotalUC = "10 000 V-Bucks", Price = 4139, OldPrice = 4139, Discount = 0 },
        new { Amount = "13500", Bonus = "", TotalUC = "13 500 V-Bucks", Price = 5550, OldPrice = 5550, Discount = 0 }
    };

    // Roblox products (Robux)
    var robloxProducts = new[] {
        new { Amount = "100", Bonus = "", TotalUC = "100 –†–æ–±—É–∫—Å–æ–≤", Price = 267, OldPrice = 267, Discount = 0 },
        new { Amount = "200", Bonus = "", TotalUC = "200 –†–æ–±—É–∫—Å–æ–≤", Price = 274, OldPrice = 274, Discount = 0 },
        new { Amount = "400", Bonus = "", TotalUC = "400 –†–æ–±—É–∫—Å–æ–≤", Price = 489, OldPrice = 489, Discount = 0 },
        new { Amount = "800", Bonus = "", TotalUC = "800 –†–æ–±—É–∫—Å–æ–≤", Price = 815, OldPrice = 815, Discount = 0 },
        new { Amount = "1700", Bonus = "", TotalUC = "1700 –†–æ–±—É–∫—Å–æ–≤", Price = 1976, OldPrice = 1976, Discount = 0 },
        new { Amount = "2000", Bonus = "", TotalUC = "2000 –†–æ–±—É–∫—Å–æ–≤", Price = 1985, OldPrice = 1985, Discount = 0 },
        new { Amount = "2700", Bonus = "", TotalUC = "2700 –†–æ–±—É–∫—Å–æ–≤", Price = 2800, OldPrice = 2800, Discount = 0 },
        new { Amount = "3600", Bonus = "", TotalUC = "3600 –†–æ–±—É–∫—Å–æ–≤", Price = 3890, OldPrice = 3890, Discount = 0 },
        new { Amount = "4500", Bonus = "", TotalUC = "4500 –†–æ–±—É–∫—Å–æ–≤", Price = 4110, OldPrice = 4110, Discount = 0 },
        new { Amount = "7500", Bonus = "", TotalUC = "7500 –†–æ–±—É–∫—Å–æ–≤", Price = 7354, OldPrice = 7354, Discount = 0 },
        new { Amount = "10000", Bonus = "", TotalUC = "10000 –†–æ–±—É–∫—Å–æ–≤", Price = 8243, OldPrice = 8243, Discount = 0 }
    };

    // Roblox Gift Cards (–ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã)
    var robloxCards = new[] {
        new { Amount = "200", Bonus = "", TotalUC = "200 —Ä–æ–±—É–∫—Å–æ–≤, RU", Price = 269, OldPrice = 269, Discount = 0, Region = "RU" },
        new { Amount = "300", Bonus = "", TotalUC = "300 —Ä–æ–±—É–∫—Å–æ–≤, RU", Price = 407, OldPrice = 407, Discount = 0, Region = "RU" },
        new { Amount = "300", Bonus = "", TotalUC = "300 —Ä–æ–±—É–∫—Å–æ–≤, USA", Price = 287, OldPrice = 287, Discount = 0, Region = "USA" },
        new { Amount = "400", Bonus = "", TotalUC = "400 —Ä–æ–±—É–∫—Å–æ–≤, RU", Price = 531, OldPrice = 531, Discount = 0, Region = "RU" },
        new { Amount = "400", Bonus = "", TotalUC = "400 —Ä–æ–±—É–∫—Å–æ–≤, USA", Price = 415, OldPrice = 415, Discount = 0, Region = "USA" },
        new { Amount = "450", Bonus = "", TotalUC = "450 —Ä–æ–±—É–∫—Å–æ–≤, RU", Price = 572, OldPrice = 572, Discount = 0, Region = "RU" },
        new { Amount = "500", Bonus = "", TotalUC = "500 —Ä–æ–±—É–∫—Å–æ–≤, RU", Price = 663, OldPrice = 663, Discount = 0, Region = "RU" },
        new { Amount = "500", Bonus = "", TotalUC = "500 —Ä–æ–±—É–∫—Å–æ–≤, USA", Price = 500, OldPrice = 500, Discount = 0, Region = "USA" }
    };

    // Honkai Star Rail products (Oneiric Shards / –°—É—â–Ω–æ—Å—Ç–∏ –î—Ä–µ–≤–Ω–∏—Ö –°–Ω–æ–≤)
    var honkaiProducts = new[] {
        new { Amount = "60", Bonus = "", TotalUC = "60 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 55, OldPrice = 88, Discount = 38 },
        new { Amount = "300", Bonus = "+30", TotalUC = "330 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 277, OldPrice = 438, Discount = 37 },
        new { Amount = "980", Bonus = "+110", TotalUC = "1090 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 831, OldPrice = 1318, Discount = 37 },
        new { Amount = "1280", Bonus = "+140", TotalUC = "1420 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 1119, OldPrice = 1775, Discount = 37 },
        new { Amount = "1980", Bonus = "+260", TotalUC = "2240 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 1737, OldPrice = 2755, Discount = 37 },
        new { Amount = "3280", Bonus = "+600", TotalUC = "3880 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 2961, OldPrice = 4698, Discount = 37 },
        new { Amount = "4260", Bonus = "+710", TotalUC = "4970 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 3654, OldPrice = 6766, Discount = 46 },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "8080 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 5355, OldPrice = 9914, Discount = 46 }
    };

    // Honkai All Packs (x2, x3, etc)
    var honkaiPacks = new[] {
        new { Amount = "9760", Bonus = "+2200", TotalUC = "11960 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 8298, OldPrice = 16761, Discount = 50, Multiplier = "" },
        new { Amount = "All pack", Bonus = "", TotalUC = "All Pack", Price = 11034, OldPrice = 22290, Discount = 50, Multiplier = "" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "16160 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 11254, OldPrice = 16955, Discount = 34, Multiplier = "x2" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "24240 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 16650, OldPrice = 25433, Discount = 35, Multiplier = "x3" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "32320 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 22120, OldPrice = 30721, Discount = 28, Multiplier = "x4" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "40400 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 28309, OldPrice = 42387, Discount = 33, Multiplier = "x5" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "64640 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 44640, OldPrice = 90181, Discount = 50, Multiplier = "x8" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "80800 –°—É—â–Ω–æ—Å—Ç–µ–π", Price = 55364, OldPrice = 85805, Discount = 35, Multiplier = "x10" }
    };

    // Genshin Impact products (Genesis Crystals)
    var genshinProducts = new[] {
        new { Amount = "60", Bonus = "", TotalUC = "60 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 53, OldPrice = 78, Discount = 32 },
        new { Amount = "300", Bonus = "+30", TotalUC = "330 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 269, OldPrice = 397, Discount = 32 },
        new { Amount = "980", Bonus = "+110", TotalUC = "1090 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 832, OldPrice = 1232, Discount = 32 },
        new { Amount = "1980", Bonus = "+260", TotalUC = "2240 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 1793, OldPrice = 2656, Discount = 32 },
        new { Amount = "3280", Bonus = "+600", TotalUC = "3880 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 2943, OldPrice = 4360, Discount = 33 },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "8080 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 5497, OldPrice = 7184, Discount = 23 }
    };

    // Genshin All Packs (x2, x3, etc)
    var genshinPacks = new[] {
        new { Amount = "9760", Bonus = "+2200", TotalUC = "11960 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 8565, OldPrice = 10232, Discount = 16, Multiplier = "" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "16160 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 11069, OldPrice = 13223, Discount = 16, Multiplier = "x2" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "All Pack Genesis Crystals", Price = 11089, OldPrice = 13248, Discount = 16, Multiplier = "x2" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "24240 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 16871, OldPrice = 20155, Discount = 16, Multiplier = "x3" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "32320 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 21895, OldPrice = 26158, Discount = 16, Multiplier = "x4" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "40400 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 27703, OldPrice = 33097, Discount = 16, Multiplier = "x5" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "64640 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 43364, OldPrice = 53535, Discount = 19, Multiplier = "x8" },
        new { Amount = "6480", Bonus = "+1600", TotalUC = "80800 –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤", Price = 56303, OldPrice = 69508, Discount = 19, Multiplier = "x10" }
    };

    // Mobile Legends products
    var mlProducts = new[] {
        new { Amount = "32", Bonus = "+3", TotalUC = "35 –∞–ª–º–∞–∑–æ–≤", Price = 59, OldPrice = 90, Discount = 34 },
        new { Amount = "50", Bonus = "+5", TotalUC = "55 –∞–ª–º–∞–∑–æ–≤", Price = 92, OldPrice = 102, Discount = 10 },
        new { Amount = "150", Bonus = "+15", TotalUC = "165 –∞–ª–º–∞–∑–æ–≤", Price = 280, OldPrice = 311, Discount = 10 },
        new { Amount = "250", Bonus = "+25", TotalUC = "275 –∞–ª–º–∞–∑–æ–≤", Price = 470, OldPrice = 723, Discount = 35 },
        new { Amount = "500", Bonus = "+65", TotalUC = "565 –∞–ª–º–∞–∑–æ–≤", Price = 938, OldPrice = 1103, Discount = 15 },
        new { Amount = "1000", Bonus = "+155", TotalUC = "1155 –∞–ª–º–∞–∑–æ–≤", Price = 1871, OldPrice = 2201, Discount = 15 },
        new { Amount = "1500", Bonus = "+265", TotalUC = "1765 –∞–ª–º–∞–∑–æ–≤", Price = 2828, OldPrice = 3327, Discount = 15 },
        new { Amount = "2500", Bonus = "+475", TotalUC = "2975 –∞–ª–º–∞–∑–æ–≤", Price = 4678, OldPrice = 5503, Discount = 15 }
    };

    // Default PUBG products
    var pubgProducts = new[] {
        new { Amount = "57", Bonus = "+3", TotalUC = "60 UC", Price = 73, OldPrice = 132, Discount = 45 },
        new { Amount = "300", Bonus = "+25", TotalUC = "325 UC", Price = 376, OldPrice = 683, Discount = 45 },
        new { Amount = "600", Bonus = "+60", TotalUC = "660 UC", Price = 741, OldPrice = 1140, Discount = 35 },
        new { Amount = "985", Bonus = "", TotalUC = "985 UC", Price = 1276, OldPrice = 1963, Discount = 35 },
        new { Amount = "1320", Bonus = "", TotalUC = "1320 UC", Price = 1669, OldPrice = 2781, Discount = 40 },
        new { Amount = "1500", Bonus = "+300", TotalUC = "1800 UC", Price = 2077, OldPrice = 3461, Discount = 40 },
        new { Amount = "2460", Bonus = "", TotalUC = "2460 UC", Price = 2961, OldPrice = 4934, Discount = 40 },
        new { Amount = "3000", Bonus = "+850", TotalUC = "3850 UC", Price = 4129, OldPrice = 6881, Discount = 40 }
    };

    // Select products based on game - prefer database products if available
    var hasDbProducts = dbGame?.Products != null && dbGame.Products.Any(p => p.IsActive);
    var dbProducts = hasDbProducts
        ? dbGame.Products.Where(p => p.IsActive).OrderBy(p => p.SortOrder).ThenBy(p => p.Price).ToList()
        : new List<GameProduct>();

    // Filter DB products by type
    var dbCurrencies = dbProducts.Where(p => p.ProductType == GameProductType.Currency).ToList();
    var dbPacks = dbProducts.Where(p => p.ProductType == GameProductType.Pack).ToList();
    var dbPasses = dbProducts.Where(p => p.ProductType == GameProductType.Pass).ToList();
    var dbSubscriptions = dbProducts.Where(p => p.ProductType == GameProductType.Subscription).ToList();
    var dbPromos = dbProducts.Where(p => p.ProductType == GameProductType.Promo).ToList();

    var hasDbCurrencies = dbCurrencies.Any();
    var hasDbPacks = dbPacks.Any();
    var hasDbPasses = dbPasses.Any();
    var hasDbSubscriptions = dbSubscriptions.Any();
    var hasDbPromos = dbPromos.Any();

    // Fallback to demo products if no database products
    var demoProducts = isFortnite ? fortniteProducts : (isRoblox ? robloxProducts : (isHonkai ? honkaiProducts : (isGenshin ? genshinProducts : (isMobileLegends ? mlProducts : pubgProducts))));
}

<style>
    /* Inherit global container styles - no local override */

    .game-page {
        display: flex;
        gap: 1.5rem;
        padding: 1rem 0;
    }

    /* Sidebar - wider to align with –ö–∞—Ç–∞–ª–æ–≥ */
    .game-sidebar {
        width: 280px;
        flex-shrink: 0;
    }

    @@media (max-width: 1200px) {
        .game-sidebar { display: none; }
    }

    /* Search box in sidebar */
    .sidebar-search {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 0.6rem 0.9rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .sidebar-search input {
        background: transparent;
        border: none;
        color: white;
        font-size: 0.85rem;
        width: 100%;
    }

    .sidebar-search input:focus {
        outline: none;
    }

    .sidebar-search input::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    .sidebar-search i {
        color: rgba(255, 255, 255, 0.4);
        font-size: 0.9rem;
    }

    .sidebar-game {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.6rem 0.75rem;
        border-radius: 12px;
        text-decoration: none;
        color: white;
        transition: all 0.3s ease;
        margin-bottom: 0.25rem;
        background: transparent;
    }

    .sidebar-game:hover, .sidebar-game.active {
        background: rgba(255, 255, 255, 0.05);
        color: white;
    }

    .sidebar-game.active {
        background: rgba(102, 126, 234, 0.15);
    }

    .sidebar-game-icon {
        width: 42px;
        height: 42px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        background: rgba(255, 255, 255, 0.05);
        overflow: hidden;
        flex-shrink: 0;
    }

    .sidebar-game-icon img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .sidebar-game-info {
        display: flex;
        flex-direction: column;
        min-width: 0;
    }

    .sidebar-game-name {
        font-weight: 500;
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .sidebar-game-subtitle {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
    }

    /* Main Content */
    .game-main {
        flex-grow: 1;
        min-width: 0;
    }

    /* UID Input */
    .uid-section {
        background: linear-gradient(145deg, #1f1f3a 0%, #161630 100%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 1.1rem 1.5rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
    }

    .uid-section:focus-within {
        border-color: rgba(102, 126, 234, 0.5);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.15);
    }

    .uid-input {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: white;
        font-size: 1.05rem;
        padding: 0.5rem 0;
        font-weight: 500;
    }

    .uid-input:focus {
        outline: none;
    }

    .uid-input::placeholder {
        color: rgba(255, 255, 255, 0.35);
        font-weight: 400;
    }

    .uid-checkbox {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        color: rgba(255, 255, 255, 0.85);
        font-size: 0.9rem;
        cursor: pointer;
        white-space: nowrap;
        font-weight: 500;
    }

    .uid-checkbox input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #22c55e;
        cursor: pointer;
    }

    .uid-help-link {
        color: rgba(255, 255, 255, 0.5);
        text-decoration: none;
        font-size: 0.85rem;
        white-space: nowrap;
        transition: color 0.2s;
    }

    .uid-help-link:hover {
        color: #667eea;
    }

    .region-section {
        position: relative;
    }

    .region-flag {
        font-size: 1.25rem;
    }

    .region-select {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        appearance: none;
        padding: 0.5rem 0;
    }

    .region-select:focus {
        outline: none;
    }

    .region-select option {
        background: #1a1a2e;
        color: white;
    }

    .uid-confirm-row {
        margin-bottom: 1.25rem;
    }

    /* Section Title */
    .section-title {
        font-size: 1.15rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #ffffff;
        letter-spacing: 0.01em;
    }

    /* Currency Cards - kupikod.com exact style: IMAGE ONLY, caption below */

    /* Product item wrapper - image + caption separate */
    .product-item {
        display: flex;
        flex-direction: column;
        cursor: pointer;
    }

    .currency-card {
        background: linear-gradient(145deg, #1e1e38 0%, #161630 100%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 0;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        aspect-ratio: 1;
    }

    .currency-card:hover {
        border-color: rgba(102, 126, 234, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .product-item.selected .currency-card {
        border-color: #22c55e;
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.25);
    }

    /* Selected badge - top right */
    .currency-card-selected-badge {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: #22c55e;
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.65rem;
        font-weight: 600;
        display: none;
        align-items: center;
        gap: 0.2rem;
        z-index: 10;
    }

    .product-item.selected .currency-card-selected-badge {
        display: flex;
    }

    /* Hide old header completely */
    .currency-card-header {
        display: none !important;
    }

    .currency-card-bonus {
        display: none !important;
    }

    .currency-card-multiplier {
        position: absolute;
        top: 0.5rem;
        left: 0.5rem;
        background: #f59e0b;
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.65rem;
        font-weight: 600;
        z-index: 10;
    }

    /* Image area - FILL THE ENTIRE CARD */
    .currency-card-image {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }

    .currency-card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Green amount badge - HIDDEN for game currency pages */
    .currency-card-badge {
        display: none;
    }

    .currency-card-placeholder {
        font-size: 3.5rem;
        opacity: 0.9;
    }

    /* Caption OUTSIDE the card */
    .product-caption {
        padding: 0.5rem 0.25rem;
        text-align: left;
    }

    .product-caption-price {
        font-size: 1rem;
        font-weight: 700;
        color: #ffffff;
        margin-bottom: 0.1rem;
    }

    .product-caption-name {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.6);
        font-weight: 400;
    }

    .product-caption-discount {
        font-size: 0.65rem;
        background: #ef4444;
        color: white;
        padding: 0.1rem 0.3rem;
        border-radius: 3px;
        font-weight: 600;
        margin: 0 0.25rem;
    }

    .product-caption-old-price {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        text-decoration: line-through;
        font-weight: 400;
    }

    /* Footer - HIDDEN (moved to caption) */
    .currency-card-footer {
        display: none !important;
    }

    .currency-card-price-row {
        display: none !important;
    }

    .currency-card-total {
        display: none !important;
    }

    /* Payment Sidebar */
    .payment-sidebar {
        width: 300px;
        flex-shrink: 0;
        position: sticky;
        top: 100px;
        height: fit-content;
        align-self: flex-start;
    }

    @@media (max-width: 992px) {
        .game-page { flex-direction: column; }
        .payment-sidebar {
            width: 100%;
            position: relative;
            order: -1;
        }
    }

    .payment-card {
        background: linear-gradient(145deg, #1f1f3a 0%, #161630 100%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 1.5rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .payment-product {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 1rem;
    }

    .payment-product-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        overflow: hidden;
    }

    .payment-product-icon img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .payment-product-info {
        flex-grow: 1;
    }

    .payment-product-name {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
    }

    .payment-product-amount {
        font-size: 1.1rem;
        font-weight: 700;
    }

    .payment-section-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: rgba(255, 255, 255, 0.8);
    }

    /* Payment Categories (Level 1) */
    .payment-categories {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
        margin-bottom: 0.75rem;
    }

    .payment-category {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid transparent;
        border-radius: 10px;
        padding: 0.6rem 0.4rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
    }

    .payment-category:hover {
        border-color: rgba(102, 126, 234, 0.3);
    }

    .payment-category.selected {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
    }

    .payment-category-icon {
        font-size: 1.25rem;
        margin-bottom: 0.15rem;
    }

    .payment-category-name {
        font-size: 0.65rem;
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.2;
    }

    /* Payment Methods (Level 2) */
    .payment-methods-container {
        margin-bottom: 1.25rem;
    }

    .payment-methods-group {
        display: none;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
    }

    .payment-methods-group.active {
        display: grid;
    }

    .payment-method {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid transparent;
        border-radius: 10px;
        padding: 0.75rem 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
    }

    .payment-method:hover {
        border-color: rgba(102, 126, 234, 0.3);
    }

    .payment-method.selected {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
    }

    .payment-method-icon {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
    }

    .payment-method-name {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.7);
    }

    .payment-promo {
        margin-bottom: 1.25rem;
    }

    .payment-promo-input {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 0.75rem 1rem;
        gap: 0.75rem;
    }

    .payment-promo-input i {
        color: rgba(255, 255, 255, 0.4);
    }

    .payment-promo-input input {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: white;
        font-size: 0.9rem;
    }

    .payment-promo-input input:focus {
        outline: none;
    }

    .payment-promo-input input::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    .payment-summary {
        margin-bottom: 1rem;
    }

    .payment-summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }

    .payment-summary-label {
        color: rgba(255, 255, 255, 0.6);
    }

    .payment-summary-value {
        color: white;
    }

    .payment-summary-value.discount {
        color: #22c55e;
    }

    .payment-summary-total {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        padding-top: 0.75rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: 0.5rem;
    }

    .payment-total-label {
        font-size: 1rem;
        font-weight: 600;
    }

    .payment-total-value {
        font-size: 1.85rem;
        font-weight: 700;
        color: #ffffff;
    }

    .payment-button {
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 12px;
        padding: 1rem;
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 0.75rem;
    }

    .payment-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .payment-terms {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.4);
        text-align: center;
        line-height: 1.4;
    }

    .payment-terms a {
        color: #667eea;
        text-decoration: none;
    }

    .payment-delivery {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .payment-delivery-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .payment-delivery-label {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
    }

    .payment-delivery-value {
        font-size: 0.85rem;
        color: white;
    }

    .payment-delivery-value.highlight {
        color: #22c55e;
    }

    /* Trust Badge */
    .trust-badge {
        background: linear-gradient(145deg, #1f1f3a 0%, #161630 100%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 1.1rem 1.25rem;
        margin-top: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
    }

    .trust-badge-item {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        flex: 1;
        justify-content: center;
    }

    .trust-badge-icon {
        font-size: 1.6rem;
    }

    .trust-badge-text {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.85);
        line-height: 1.3;
    }

    .trust-badge-divider {
        width: 1px;
        height: 2.5rem;
        background: rgba(255, 255, 255, 0.1);
        margin: 0 0.75rem;
    }

    /* Sections */
    .product-section {
        margin-bottom: 3rem;
        scroll-margin-top: 80px;
    }

    .product-section:last-child {
        margin-bottom: 0;
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 1.25rem;
        color: #ffffff;
        letter-spacing: -0.01em;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-title::before {
        content: '';
        width: 4px;
        height: 1.3rem;
        background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        border-radius: 2px;
    }

    /* Tabs */
    .game-tabs {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 2rem;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 14px;
    }

    .game-tab {
        background: transparent;
        border: none;
        border-radius: 10px;
        padding: 0.85rem 1.5rem;
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.95rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .game-tab:hover {
        background: rgba(255, 255, 255, 0.06);
        color: #ffffff;
    }

    .game-tab.active {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
        color: #ffffff;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
    }

    /* Fix grid layout - 4 columns always fitting the container */
    .currency-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 0.75rem;
    }

    @@media (max-width: 1200px) {
        .currency-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @@media (max-width: 900px) {
        .currency-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @@media (max-width: 576px) {
        .currency-grid { grid-template-columns: minmax(0, 1fr); }
    }

    /* Make sure cards don't overflow */
    .currency-card {
        min-width: 0;
        overflow: hidden;
    }

    /* Purchase Modal */
    .purchase-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    .purchase-overlay.active { display: flex; }

    .purchase-modal {
        background: linear-gradient(145deg, #1f1f3a 0%, #161630 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        width: 90%;
        max-width: 700px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
    }

    .purchase-modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 1rem 1.5rem;
        border-radius: 20px 20px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .purchase-modal-header h3 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
    }

    .purchase-modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        opacity: 0.8;
    }
    .purchase-modal-close:hover { opacity: 1; }

    .purchase-modal-body {
        padding: 1.5rem;
        display: flex;
        gap: 1.5rem;
    }

    @@media (max-width: 600px) {
        .purchase-modal-body { flex-direction: column; }
        .purchase-modal-left { width: 100% !important; }
    }

    .purchase-modal-left {
        width: 240px;
        flex-shrink: 0;
    }

    .purchase-modal-image {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 1rem;
        background: linear-gradient(145deg, #1e1e38 0%, #161630 100%);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .purchase-modal-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .purchase-modal-image .modal-placeholder {
        font-size: 4rem;
    }

    .purchase-modal-product-name {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .purchase-modal-product-desc {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 0.75rem;
    }

    .purchase-modal-price-row {
        font-size: 1.25rem;
        font-weight: 700;
    }

    .purchase-modal-price-row .old-price {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.4);
        text-decoration: line-through;
        font-weight: 400;
        margin-left: 0.5rem;
    }

    .purchase-modal-right {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .modal-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 0.5rem;
    }

    .modal-input {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 0.85rem 1rem;
        color: white;
        font-size: 0.9rem;
    }
    .modal-input:focus { outline: none; border-color: rgba(102, 126, 234, 0.5); }
    .modal-input::placeholder { color: rgba(255, 255, 255, 0.3); }

    .modal-hint {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        margin-top: 0.25rem;
    }

    .modal-info-banner {
        background: rgba(102, 126, 234, 0.1);
        border: 1px solid rgba(102, 126, 234, 0.3);
        border-radius: 10px;
        padding: 0.75rem 1rem;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.7);
    }
    .modal-info-banner a { color: #667eea; }

    .modal-payment-methods {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    .modal-pay-method {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.04);
        border: 2px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 0.75rem 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .modal-pay-method:hover:not(.disabled) { border-color: rgba(102, 126, 234, 0.4); }
    .modal-pay-method.selected { border-color: #667eea; background: rgba(102, 126, 234, 0.08); }
    .modal-pay-method.disabled { opacity: 0.5; cursor: not-allowed; }
    .modal-pay-method-left { display: flex; align-items: center; gap: 0.75rem; }
    .modal-pay-method-icon { width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.1rem; flex-shrink: 0; }
    .modal-pay-method-title { font-size: 0.9rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); }
    .modal-pay-method-desc { font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-top: 0.1rem; }
    .modal-pay-method-right { display: flex; align-items: center; gap: 0.5rem; }
    .modal-pay-badge-instant { font-size: 0.7rem; color: #22c55e; font-weight: 600; }
    .modal-pay-badge-soon { font-size: 0.65rem; background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.5); padding: 0.2rem 0.5rem; border-radius: 6px; }
    .modal-pay-radio { width: 20px; height: 20px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.2); position: relative; flex-shrink: 0; }
    .modal-pay-radio.active { border-color: #667eea; }
    .modal-pay-radio.active::after { content: ''; position: absolute; top: 3px; left: 3px; width: 10px; height: 10px; border-radius: 50%; background: #667eea; }

    .modal-promo-section { margin-top: 0; }
    .modal-promo-row { display: flex; gap: 0.5rem; }
    .modal-promo-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        padding: 0.7rem 1.2rem;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    .modal-promo-btn:hover { background: rgba(255, 255, 255, 0.15); }

    .modal-agreement {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
    }
    .modal-agreement input { margin-top: 0.15rem; }
    .modal-agreement a { color: #667eea; }

    .modal-pay-button {
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 12px;
        padding: 1rem;
        color: white;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    .modal-pay-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }
</style>

<div class="container container-wide">
    <div class="game-page">
        <!-- Sidebar -->
        <aside class="game-sidebar">
            <!-- Search box -->
            <div class="sidebar-search">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="–ü–æ–∏—Å–∫" id="gameSearch" onkeyup="filterGames(this.value)">
            </div>

            <div id="gamesList">
            @foreach (var game in sidebarGames)
            {
                var isActive = game.Slug.ToLower() == gameSlug.ToLower();
                var hasImage = !string.IsNullOrEmpty(game.ImageUrl);

                <a href="/Catalog/Game/@game.Slug" class="sidebar-game @(isActive ? "active" : "")">
                    <div class="sidebar-game-icon">
                        @if (hasImage)
                        {
                            <img src="@game.ImageUrl" alt="@game.Name" />
                        }
                        else
                        {
                            <span>@game.Icon</span>
                        }
                    </div>
                    <div class="sidebar-game-info">
                        <span class="sidebar-game-name">@game.Name</span>
                        @if (!string.IsNullOrEmpty(game.Subtitle))
                        {
                            <span class="sidebar-game-subtitle">@game.Subtitle</span>
                        }
                    </div>
                </a>
            }
            </div>
        </aside>

        <!-- Main Content -->
        <main class="game-main">
            <!-- Tabs -->
            <div class="game-tabs">
                @if (isFortnite)
                {
                    <button class="game-tab active" onclick="scrollToSection('section-uc')">V-Bucks</button>
                }
                else if (isMobileLegends)
                {
                    <button class="game-tab active" onclick="scrollToSection('section-uc')">–ê–ª–º–∞–∑—ã</button>
                    <button class="game-tab" onclick="scrollToSection('section-passes')">–ü—Ä–æ–ø—É—Å–∫–∏</button>
                    <button class="game-tab" onclick="scrollToSection('section-promo')">–ê–∫—Ü–∏—è</button>
                }
                else if (isGenshin)
                {
                    <button class="game-tab active" onclick="scrollToSection('section-uc')">–ö—Ä–∏—Å—Ç–∞–ª–ª—ã –°–æ—Ç–≤–æ—Ä–µ–Ω–∏—è</button>
                    <button class="game-tab" onclick="scrollToSection('section-packs')">All Pack</button>
                    <button class="game-tab" onclick="scrollToSection('section-passes')">–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –õ—É–Ω—ã</button>
                }
                else if (isHonkai)
                {
                    <button class="game-tab active" onclick="scrollToSection('section-uc')">–°—É—â–Ω–æ—Å—Ç–∏ –î—Ä–µ–≤–Ω–∏—Ö –°–Ω–æ–≤</button>
                    <button class="game-tab" onclick="scrollToSection('section-packs')">–í—ã–≥–æ–¥–Ω—ã–µ –Ω–∞–±–æ—Ä—ã</button>
                }
                else if (isRoblox)
                {
                    <button class="game-tab active" onclick="scrollToSection('section-uc')">Robux</button>
                }
                else
                {
                    <button class="game-tab active" onclick="scrollToSection('section-uc')">–ö—É–ø–∏—Ç—å @gameInfo.CurrencyShort @gameName</button>
                    <button class="game-tab" onclick="scrollToSection('section-packs')">–í—ã–≥–æ–¥–Ω—ã–µ –ø–∞–∫–∏</button>
                    <button class="game-tab" onclick="scrollToSection('section-passes')">–ü—Ä–æ–ø—É—Å–∫–∏</button>
                    <button class="game-tab" onclick="scrollToSection('section-subscription')">–ü–æ–¥–ø–∏—Å–∫–∞ Prime</button>
                }
            </div>

            <!-- Section: Buy Currency -->
            <div class="product-section" id="section-uc">
                <h2 class="section-title">@(isFortnite ? "V-Bucks" : (isRoblox ? "Robux" : (isHonkai ? "–°—É—â–Ω–æ—Å—Ç–∏ –î—Ä–µ–≤–Ω–∏—Ö –°–Ω–æ–≤" : (isGenshin ? "–ö—Ä–∏—Å—Ç–∞–ª–ª—ã –°–æ—Ç–≤–æ—Ä–µ–Ω–∏—è" : (isMobileLegends ? "–ê–ª–º–∞–∑—ã" : $"–ö—É–ø–∏—Ç—å {gameInfo.CurrencyShort} {gameName}")))))</h2>
                <div class="currency-grid">
                    @if (hasDbCurrencies)
                    {
                        @* Render currency products from database *@
                        @foreach (var item in dbCurrencies)
                        {
                            var discount = item.OldPrice.HasValue && item.OldPrice > item.Price
                                ? (int)Math.Round((1 - (double)item.Price / (double)item.OldPrice.Value) * 100)
                                : item.Discount;
                            var oldPrice = item.OldPrice ?? item.Price;
                            var displayName = !string.IsNullOrEmpty(item.TotalDisplay) ? item.TotalDisplay : item.Name;
                            var hasImage = !string.IsNullOrEmpty(item.ImageUrl);

                            <div class="product-item" onclick="selectProduct(this, @item.Id, '@(item.Amount ?? "")', '@displayName', @((int)item.Price), @((int)oldPrice))">
                                <div class="currency-card">
                                    <span class="currency-card-badge">@(item.Amount ?? displayName)</span>
                                    <span class="currency-card-selected-badge">–í—ã–±—Ä–∞–Ω–æ <i class="bi bi-check"></i></span>
                                    @if (!string.IsNullOrEmpty(item.Multiplier))
                                    {
                                        <span class="currency-card-multiplier">@item.Multiplier</span>
                                    }
                                    <div class="currency-card-image">
                                        @if (hasImage)
                                        {
                                            <img src="@item.ImageUrl" alt="@item.Name" />
                                        }
                                        else
                                        {
                                            <span class="currency-card-placeholder">@(isRoblox ? "ü™ô" : (isHonkai ? "üîÆ" : (isGenshin ? "üí†" : (isMobileLegends ? "üíé" : "üí∞"))))</span>
                                        }
                                    </div>
                                </div>
                                <div class="product-caption">
                                    <div class="product-caption-price">
                                        @item.Price.ToString("N0") ‚ÇΩ
                                        @if (discount > 0)
                                        {
                                            <span class="product-caption-discount">-@discount%</span>
                                            <span class="product-caption-old-price">@oldPrice.ToString("N0") ‚ÇΩ</span>
                                        }
                                    </div>
                                    <div class="product-caption-name">@displayName</div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        @* Fallback to hardcoded demo products *@
                        @foreach (var item in demoProducts)
                        {
                            <div class="product-item" onclick="selectProduct(this, 0, '@item.Amount', '@item.TotalUC', @item.Price, @item.OldPrice)">
                                <div class="currency-card">
                                    <span class="currency-card-badge">@item.Amount</span>
                                    <span class="currency-card-selected-badge">–í—ã–±—Ä–∞–Ω–æ <i class="bi bi-check"></i></span>
                                    <div class="currency-card-image">
                                        <span class="currency-card-placeholder">@(isRoblox ? "ü™ô" : (isHonkai ? "üîÆ" : (isGenshin ? "üí†" : (isMobileLegends ? "üíé" : (isFortnite ? "üéÆ" : "üí∞")))))</span>
                                    </div>
                                </div>
                                <div class="product-caption">
                                    <div class="product-caption-price">
                                        @item.Price.ToString("N0") ‚ÇΩ
                                        @if (item.Discount > 0)
                                        {
                                            <span class="product-caption-discount">-@item.Discount%</span>
                                            <span class="product-caption-old-price">@item.OldPrice.ToString("N0") ‚ÇΩ</span>
                                        }
                                    </div>
                                    <div class="product-caption-name">@item.TotalUC</div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>

            @if (hasDbPacks)
            {
                <!-- Section: Packs from DB -->
                <div class="product-section" id="section-packs">
                    <h2 class="section-title">@(isGenshin || isHonkai ? "–í—ã–≥–æ–¥–Ω—ã–µ –Ω–∞–±–æ—Ä—ã" : "–í—ã–≥–æ–¥–Ω—ã–µ –ø–∞–∫–∏")</h2>
                    <div class="currency-grid">
                        @foreach (var item in dbPacks)
                        {
                            var discount = item.OldPrice.HasValue && item.OldPrice > item.Price
                                ? (int)Math.Round((1 - (double)item.Price / (double)item.OldPrice.Value) * 100)
                                : item.Discount;
                            var oldPrice = item.OldPrice ?? item.Price;
                            var displayName = !string.IsNullOrEmpty(item.TotalDisplay) ? item.TotalDisplay : item.Name;
                            var badgeText = !string.IsNullOrEmpty(item.Amount) ? item.Amount : item.Name;
                            var hasImage = !string.IsNullOrEmpty(item.ImageUrl);
                            var emoji = isRoblox ? "ü™ô" : (isHonkai ? "üîÆ" : (isGenshin ? "üí†" : (isMobileLegends ? "üíé" : (isFortnite ? "üéÆ" : "üí∞"))));
                            <div class="product-item" onclick="selectProduct(this, 0, '@item.Amount', '@displayName', @item.Price, @oldPrice)">
                                <div class="currency-card">
                                    <span class="currency-card-badge">@badgeText</span>
                                    <span class="currency-card-selected-badge">–í—ã–±—Ä–∞–Ω–æ <i class="bi bi-check"></i></span>
                                    @if (!string.IsNullOrEmpty(item.Multiplier))
                                    {
                                        <span class="currency-card-multiplier">@item.Multiplier</span>
                                    }
                                    <div class="currency-card-image">
                                        @if (hasImage)
                                        {
                                            <img src="@item.ImageUrl" alt="@item.Name" />
                                        }
                                        else
                                        {
                                            <span class="currency-card-placeholder">@emoji</span>
                                        }
                                    </div>
                                </div>
                                <div class="product-caption">
                                    <div class="product-caption-price">
                                        @item.Price.ToString("N0") ‚ÇΩ
                                        @if (discount > 0)
                                        {
                                            <span class="product-caption-discount">-@discount%</span>
                                            <span class="product-caption-old-price">@oldPrice.ToString("N0") ‚ÇΩ</span>
                                        }
                                    </div>
                                    <div class="product-caption-name">@displayName</div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (hasDbPasses)
            {
                <!-- Section: Passes from DB -->
                <div class="product-section" id="section-passes">
                    <h2 class="section-title">@(isGenshin ? "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –∏ –ø—Ä–æ–ø—É—Å–∫–∏" : "–ü—Ä–æ–ø—É—Å–∫–∏")</h2>
                    <div class="currency-grid">
                        @foreach (var item in dbPasses)
                        {
                            var discount = item.OldPrice.HasValue && item.OldPrice > item.Price
                                ? (int)Math.Round((1 - (double)item.Price / (double)item.OldPrice.Value) * 100)
                                : item.Discount;
                            var oldPrice = item.OldPrice ?? item.Price;
                            var displayName = !string.IsNullOrEmpty(item.TotalDisplay) ? item.TotalDisplay : item.Name;
                            var badgeText = item.Name;
                            var hasImage = !string.IsNullOrEmpty(item.ImageUrl);
                            var emoji = isGenshin ? "üí†" : (isMobileLegends ? "üíé" : "üé´");
                            <div class="product-item" onclick="selectProduct(this, 0, '@item.Amount', '@displayName', @item.Price, @oldPrice)">
                                <div class="currency-card">
                                    <span class="currency-card-badge">@badgeText</span>
                                    <span class="currency-card-selected-badge">–í—ã–±—Ä–∞–Ω–æ <i class="bi bi-check"></i></span>
                                    <div class="currency-card-image">
                                        @if (hasImage)
                                        {
                                            <img src="@item.ImageUrl" alt="@item.Name" />
                                        }
                                        else
                                        {
                                            <span class="currency-card-placeholder">@emoji</span>
                                        }
                                    </div>
                                </div>
                                <div class="product-caption">
                                    <div class="product-caption-price">
                                        @item.Price.ToString("N0") ‚ÇΩ
                                        @if (discount > 0)
                                        {
                                            <span class="product-caption-discount">-@discount%</span>
                                            <span class="product-caption-old-price">@oldPrice.ToString("N0") ‚ÇΩ</span>
                                        }
                                    </div>
                                    <div class="product-caption-name">@displayName</div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (hasDbPromos)
            {
                <!-- Section: Promo from DB -->
                <div class="product-section" id="section-promo">
                    <h2 class="section-title">–ê–∫—Ü–∏—è</h2>
                    <div class="currency-grid">
                        @foreach (var item in dbPromos)
                        {
                            var discount = item.OldPrice.HasValue && item.OldPrice > item.Price
                                ? (int)Math.Round((1 - (double)item.Price / (double)item.OldPrice.Value) * 100)
                                : item.Discount;
                            var oldPrice = item.OldPrice ?? item.Price;
                            var displayName = !string.IsNullOrEmpty(item.TotalDisplay) ? item.TotalDisplay : item.Name;
                            var hasImage = !string.IsNullOrEmpty(item.ImageUrl);
                            <div class="product-item" onclick="selectProduct(this, 0, '@item.Amount', '@displayName', @item.Price, @oldPrice)">
                                <div class="currency-card">
                                    <span class="currency-card-badge">@item.Name</span>
                                    <span class="currency-card-selected-badge">–í—ã–±—Ä–∞–Ω–æ <i class="bi bi-check"></i></span>
                                    <div class="currency-card-image">
                                        @if (hasImage)
                                        {
                                            <img src="@item.ImageUrl" alt="@item.Name" />
                                        }
                                        else
                                        {
                                            <span class="currency-card-placeholder">üî•</span>
                                        }
                                    </div>
                                </div>
                                <div class="product-caption">
                                    <div class="product-caption-price">
                                        @item.Price.ToString("N0") ‚ÇΩ
                                        @if (discount > 0)
                                        {
                                            <span class="product-caption-discount">-@discount%</span>
                                            <span class="product-caption-old-price">@oldPrice.ToString("N0") ‚ÇΩ</span>
                                        }
                                    </div>
                                    <div class="product-caption-name">@displayName</div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (hasDbSubscriptions)
            {
                <!-- Section: Subscriptions from DB -->
                <div class="product-section" id="section-subscription">
                    <h2 class="section-title">–ü–æ–¥–ø–∏—Å–∫–∞ Prime</h2>
                    <div class="currency-grid">
                        @foreach (var item in dbSubscriptions)
                        {
                            var discount = item.OldPrice.HasValue && item.OldPrice > item.Price
                                ? (int)Math.Round((1 - (double)item.Price / (double)item.OldPrice.Value) * 100)
                                : item.Discount;
                            var oldPrice = item.OldPrice ?? item.Price;
                            var displayName = !string.IsNullOrEmpty(item.TotalDisplay) ? item.TotalDisplay : item.Name;
                            var hasImage = !string.IsNullOrEmpty(item.ImageUrl);
                            <div class="product-item" onclick="selectProduct(this, 0, '@item.Amount', '@displayName', @item.Price, @oldPrice)">
                                <div class="currency-card">
                                    <span class="currency-card-badge">@item.Name</span>
                                    <span class="currency-card-selected-badge">–í—ã–±—Ä–∞–Ω–æ <i class="bi bi-check"></i></span>
                                    <div class="currency-card-image">
                                        @if (hasImage)
                                        {
                                            <img src="@item.ImageUrl" alt="@item.Name" />
                                        }
                                        else
                                        {
                                            <span class="currency-card-placeholder">üëë</span>
                                        }
                                    </div>
                                </div>
                                <div class="product-caption">
                                    <div class="product-caption-price">
                                        @item.Price.ToString("N0") ‚ÇΩ
                                        @if (discount > 0)
                                        {
                                            <span class="product-caption-discount">-@discount%</span>
                                            <span class="product-caption-old-price">@oldPrice.ToString("N0") ‚ÇΩ</span>
                                        }
                                    </div>
                                    <div class="product-caption-name">@displayName</div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </main>

        <!-- Payment Sidebar -->
        <aside class="payment-sidebar">
            <div class="payment-card">
                <!-- Selected Product -->
                <div class="payment-product">
                    <div class="payment-product-icon">
                        @if (!string.IsNullOrEmpty(gameInfo.ImageUrl))
                        {
                            <img src="@gameInfo.ImageUrl" alt="@gameName" />
                        }
                        else
                        {
                            <span>@gameInfo.Icon</span>
                        }
                    </div>
                    <div class="payment-product-info">
                        <div class="payment-product-name">@gameName</div>
                        <div class="payment-product-amount" id="selectedAmount">1800 UC</div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="payment-summary">
                    <div class="payment-summary-row">
                        <span class="payment-summary-label">–¶–µ–Ω–∞</span>
                        <span class="payment-summary-value" id="originalPrice">3 461 ‚ÇΩ</span>
                    </div>
                    <div class="payment-summary-row">
                        <span class="payment-summary-label">–í—ã–≥–æ–¥–∞</span>
                        <span class="payment-summary-value discount" id="discount">-1 384 ‚ÇΩ <span style="background: #22c55e; color: white; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.7rem;">-40%</span></span>
                    </div>
                    <div class="payment-summary-total">
                        <span class="payment-total-label">–ò—Ç–æ–≥–æ</span>
                        <span class="payment-total-value" id="totalPrice">2 077 ‚ÇΩ</span>
                    </div>
                </div>

                <!-- Buy Button -->
                <button class="payment-button" onclick="openPurchaseModal()">
                    –ö—É–ø–∏—Ç—å <span id="buttonPrice">2 077</span> ‚ÇΩ
                </button>

                <!-- Delivery Info -->
                <div class="payment-delivery">
                    <div class="payment-delivery-row">
                        <span class="payment-delivery-label">–î–æ—Å—Ç–∞–≤–∫–∞</span>
                        <span class="payment-delivery-value highlight">@(isFortnite ? "–ü–æ Email" : "–ü–æ UID")</span>
                    </div>
                    <div class="payment-delivery-row">
                        <span class="payment-delivery-label">–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏</span>
                        <span class="payment-delivery-value">@(isFortnite ? "10-20 –º–∏–Ω—É—Ç" : "–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ")</span>
                    </div>
                </div>

            </div>

            <!-- Trust Badge -->
            <div class="trust-badge">
                <div class="trust-badge-item">
                    <i class="bi bi-shield-check trust-badge-icon" style="color: #667eea;"></i>
                    <span class="trust-badge-text">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è<br>–ø–æ–∫—É–ø–∫–∞</span>
                </div>
                <div class="trust-badge-divider"></div>
                <div class="trust-badge-item">
                    <i class="bi bi-bag-check trust-badge-icon" style="color: #f093fb;"></i>
                    <span class="trust-badge-text">100K+<br>–ø—Ä–æ–¥–∞–∂</span>
                </div>
            </div>
        </aside>
    </div>
</div>

@Html.AntiForgeryToken()

<!-- Purchase Modal -->
<div class="purchase-overlay" id="purchaseOverlay" onclick="if(event.target===this)closePurchaseModal()">
    <div class="purchase-modal">
        <div class="purchase-modal-header">
            <h3>–ö—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
            <button class="purchase-modal-close" onclick="closePurchaseModal()">&times;</button>
        </div>
        <div class="purchase-modal-body">
            <div class="purchase-modal-left">
                <div class="purchase-modal-image" id="modalImage">
                    <span class="modal-placeholder">@gameInfo.Icon</span>
                </div>
                <div class="purchase-modal-product-name" id="modalProductName">@gameName</div>
                <div class="purchase-modal-product-desc" id="modalProductDesc">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</div>
                <div class="purchase-modal-price-row">
                    –¶–µ–Ω–∞: <span style="color: #ef4444;" id="modalPrice">2 077 ‚ÇΩ</span>
                    <span class="old-price" id="modalOldPrice">3 461 ‚ÇΩ</span>
                </div>
            </div>
            <div class="purchase-modal-right">
                @if (isFortnite)
                {
                    <div>
                        <div class="modal-label">–í–∞—à Email:</div>
                        <input type="email" class="modal-input" id="modalInput" placeholder="Email –æ—Ç Epic Games" />
                        <div class="modal-hint">–ù–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ V-Bucks</div>
                    </div>
                }
                else if (isMobileLegends)
                {
                    <div>
                        <div class="modal-label">User ID:</div>
                        <input type="text" class="modal-input" id="modalInput" inputmode="numeric" placeholder="9-15 —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 1030612204" oninput="this.value=this.value.replace(/[^0-9]/g,'')" maxlength="15" />
                        <div class="modal-hint">–í–∞—à –∏–≥—Ä–æ–≤–æ–π User ID –∏–∑ Mobile Legends</div>
                    </div>
                    <div>
                        <div class="modal-label">Zone ID:</div>
                        <input type="text" class="modal-input" id="modalZoneInput" inputmode="numeric" placeholder="4-5 —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 13124" oninput="this.value=this.value.replace(/[^0-9]/g,'')" maxlength="5" />
                        <div class="modal-hint">Zone ID –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Ä—è–¥–æ–º —Å User ID</div>
                    </div>
                }
                else if (isRoblox)
                {
                    <div>
                        <div class="modal-label">–í–∞—à Email:</div>
                        <input type="email" class="modal-input" id="modalInput" placeholder="example@email.com" />
                        <div class="modal-hint">–ù–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–¥</div>
                    </div>
                }
                else if (isGenshin)
                {
                    <div>
                        <div class="modal-label">–í–∞—à UID:</div>
                        <input type="text" class="modal-input" id="modalInput" inputmode="numeric" placeholder="9-10 —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 700123456" oninput="this.value=this.value.replace(/[^0-9]/g,'')" maxlength="10" />
                        <div class="modal-hint">UID –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É —ç–∫—Ä–∞–Ω–∞ –≤ –∏–≥—Ä–µ</div>
                    </div>
                }
                else if (isHonkai)
                {
                    <div>
                        <div class="modal-label">–í–∞—à UID:</div>
                        <input type="text" class="modal-input" id="modalInput" inputmode="numeric" placeholder="9 —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 800123456" oninput="this.value=this.value.replace(/[^0-9]/g,'')" maxlength="9" />
                        <div class="modal-hint">UID –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞</div>
                    </div>
                }
                else
                {
                    <div>
                        <div class="modal-label">–í–∞—à Player ID:</div>
                        <input type="text" class="modal-input" id="modalInput" inputmode="numeric" placeholder="5-12 —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 567535724" oninput="this.value=this.value.replace(/[^0-9]/g,'')" maxlength="12" />
                        <div class="modal-hint">Player ID –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä—ã</div>
                    </div>
                }

                @if (User.Identity?.IsAuthenticated != true)
                {
                    <div class="modal-info-banner">
                        <i class="bi bi-info-circle" style="color: #667eea; margin-right: 0.3rem;"></i>
                        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º <a href="/Account/Register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                    </div>
                }

                <div>
                    <div class="modal-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</div>
                    <div class="modal-payment-methods">
                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            <div class="modal-pay-method selected" data-method="balance" onclick="selectModalPayment(this)">
                                <div class="modal-pay-method-left">
                                    <span class="modal-pay-method-icon" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                                        <i class="bi bi-wallet2"></i>
                                    </span>
                                    <div>
                                        <div class="modal-pay-method-title">–ë–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                                        <div class="modal-pay-method-desc">–î–æ—Å—Ç—É–ø–Ω–æ: <span id="userBalanceDisplay">@(ViewBag.UserBalance?.ToString("N2") ?? "0.00")</span> ‚ÇΩ</div>
                                    </div>
                                </div>
                                <div class="modal-pay-method-right">
                                    <span class="modal-pay-badge-instant">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</span>
                                    <span class="modal-pay-radio active"></span>
                                </div>
                            </div>
                        }
                        <div class="modal-pay-method disabled" data-method="card">
                            <div class="modal-pay-method-left">
                                <span class="modal-pay-method-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                    <i class="bi bi-credit-card"></i>
                                </span>
                                <div>
                                    <div class="modal-pay-method-title">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</div>
                                    <div class="modal-pay-method-desc">Visa, MasterCard, –ú–ò–†</div>
                                </div>
                            </div>
                            <div class="modal-pay-method-right">
                                <span class="modal-pay-badge-soon">–°–∫–æ—Ä–æ</span>
                            </div>
                        </div>
                        <div class="modal-pay-method disabled" data-method="sbp">
                            <div class="modal-pay-method-left">
                                <span class="modal-pay-method-icon" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">
                                    <i class="bi bi-lightning-charge"></i>
                                </span>
                                <div>
                                    <div class="modal-pay-method-title">–°–ë–ü</div>
                                    <div class="modal-pay-method-desc">–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</div>
                                </div>
                            </div>
                            <div class="modal-pay-method-right">
                                <span class="modal-pay-badge-soon">–°–∫–æ—Ä–æ</span>
                            </div>
                        </div>
                        <div class="modal-pay-method disabled" data-method="qr">
                            <div class="modal-pay-method-left">
                                <span class="modal-pay-method-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                                    <i class="bi bi-qr-code"></i>
                                </span>
                                <div>
                                    <div class="modal-pay-method-title">QR-–∫–æ–¥</div>
                                    <div class="modal-pay-method-desc">–û–ø–ª–∞—Ç–∞ –ø–æ QR-–∫–æ–¥—É</div>
                                </div>
                            </div>
                            <div class="modal-pay-method-right">
                                <span class="modal-pay-badge-soon">–°–∫–æ—Ä–æ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-promo-section">
                    <div class="modal-label">–ü—Ä–æ–º–æ–∫–æ–¥ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</div>
                    <div class="modal-promo-row">
                        <input type="text" class="modal-input" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" style="flex: 1;" />
                        <button class="modal-promo-btn" onclick="alert('–ü—Ä–æ–º–æ–∫–æ–¥—ã —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã!')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    </div>
                </div>

                <label class="modal-agreement">
                    <input type="checkbox" id="modalAgree" checked />
                    –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="/Terms">—É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a> –∏ <a href="/Privacy">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                </label>

                <button class="modal-pay-button" onclick="processPurchase()">
                    <i class="bi bi-cart-check"></i> –û–ø–ª–∞—Ç–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    let selectedPrice = 0;
    let selectedOldPrice = 0;
    let selectedAmount = '';
    let selectedImageUrl = '';
    let selectedProductId = 0;

    function selectProduct(item, productId, amount, totalUC, price, oldPrice) {
        selectedProductId = productId;
        // Remove selected from all items
        document.querySelectorAll('.product-item').forEach(c => {
            c.classList.remove('selected');
        });
        // Add selected to clicked item
        item.classList.add('selected');

        // Capture product image from card
        const cardImg = item.querySelector('.currency-card-image img');
        selectedImageUrl = cardImg ? cardImg.src : '';

        // Update payment sidebar
        selectedPrice = price;
        selectedOldPrice = oldPrice;
        selectedAmount = totalUC;

        const discount = oldPrice - price;
        const discountPercent = oldPrice > 0 ? Math.round((discount / oldPrice) * 100) : 0;

        document.getElementById('selectedAmount').textContent = totalUC;
        document.getElementById('originalPrice').textContent = oldPrice.toLocaleString('ru-RU') + ' ‚ÇΩ';
        document.getElementById('discount').innerHTML = '-' + discount.toLocaleString('ru-RU') + ' ‚ÇΩ <span style="background: #22c55e; color: white; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.7rem;">-' + discountPercent + '%</span>';
        document.getElementById('totalPrice').textContent = price.toLocaleString('ru-RU') + ' ‚ÇΩ';
        document.getElementById('buttonPrice').textContent = price.toLocaleString('ru-RU');
    }

    function selectPayment(method) {
        document.querySelectorAll('.payment-method').forEach(m => {
            m.classList.remove('selected');
        });
        method.classList.add('selected');
    }

    function selectCategory(el, category) {
        // Remove selected from all categories
        document.querySelectorAll('.payment-category').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');

        // Show the corresponding methods group
        document.querySelectorAll('.payment-methods-group').forEach(g => g.classList.remove('active'));
        const group = document.querySelector('.payment-methods-group[data-category="' + category + '"]');
        if (group) {
            group.classList.add('active');
            // Auto-select first method in this category
            const firstMethod = group.querySelector('.payment-method');
            if (firstMethod) {
                selectPayment(firstMethod);
            }
        }
    }

    // Purchase Modal
    function openPurchaseModal() {
        if (selectedPrice <= 0) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä');
            return;
        }
        document.getElementById('modalProductDesc').textContent = selectedAmount;
        document.getElementById('modalPrice').textContent = selectedPrice.toLocaleString('ru-RU') + ' ‚ÇΩ';
        if (selectedOldPrice > selectedPrice) {
            document.getElementById('modalOldPrice').textContent = selectedOldPrice.toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('modalOldPrice').style.display = '';
        } else {
            document.getElementById('modalOldPrice').style.display = 'none';
        }
        // Update modal image to product image
        const modalImg = document.getElementById('modalImage');
        if (selectedImageUrl) {
            modalImg.innerHTML = '<img src="' + selectedImageUrl + '" alt="Product" />';
        }
        document.getElementById('purchaseOverlay').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closePurchaseModal() {
        document.getElementById('purchaseOverlay').classList.remove('active');
        document.body.style.overflow = '';
    }

    function selectModalPayment(el) {
        if (el.classList.contains('disabled')) return;
        document.querySelectorAll('.modal-pay-method').forEach(c => {
            c.classList.remove('selected');
            const radio = c.querySelector('.modal-pay-radio');
            if (radio) radio.classList.remove('active');
        });
        el.classList.add('selected');
        const radio = el.querySelector('.modal-pay-radio');
        if (radio) radio.classList.add('active');
    }

    function scrollToSection(sectionId) {
        // Update tabs
        document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');

        // Scroll to section
        const section = document.getElementById(sectionId);
        if (section) {
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    // Update active tab on scroll
    function updateActiveTab() {
        const sections = document.querySelectorAll('.product-section');
        const tabs = document.querySelectorAll('.game-tab');

        let currentSection = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            if (window.scrollY >= sectionTop - 150) {
                currentSection = section.id;
            }
        });

        tabs.forEach((tab, index) => {
            const sectionIds = ['section-uc', 'section-packs', 'section-passes', 'section-subscription'];
            if (sectionIds[index] === currentSection) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });
    }

    window.addEventListener('scroll', updateActiveTab);

    function processPurchase() {
        const input = document.getElementById('modalInput');
        const val = input.value.trim();
        const agree = document.getElementById('modalAgree');
        const emailPattern = /^[a-zA-Z0-9._%+-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

        @if (isFortnite)
        {
            <text>
            if (!val) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ Email –æ—Ç Epic Games'); input.focus(); return; }
            if (!emailPattern.test(val)) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Email –∞–¥—Ä–µ—Å'); input.focus(); return; }
            </text>
        }
        else if (isMobileLegends)
        {
            <text>
            if (!val) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ User ID'); input.focus(); return; }
            if (!/^[0-9]{9,15}$/.test(val)) { alert('User ID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 9 –¥–æ 15 —Ü–∏—Ñ—Ä'); input.focus(); return; }
            const zoneInput = document.getElementById('modalZoneInput');
            const zoneVal = zoneInput.value.trim();
            if (!zoneVal) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ Zone ID'); zoneInput.focus(); return; }
            if (!/^[0-9]{4,5}$/.test(zoneVal)) { alert('Zone ID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4-5 —Ü–∏—Ñ—Ä'); zoneInput.focus(); return; }
            </text>
        }
        else if (isRoblox)
        {
            <text>
            if (!val) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ Email'); input.focus(); return; }
            if (!emailPattern.test(val)) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Email –∞–¥—Ä–µ—Å'); input.focus(); return; }
            </text>
        }
        else if (isGenshin)
        {
            <text>
            if (!val) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ UID'); input.focus(); return; }
            if (!/^[0-9]{9,10}$/.test(val)) { alert('UID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 9-10 —Ü–∏—Ñ—Ä'); input.focus(); return; }
            </text>
        }
        else if (isHonkai)
        {
            <text>
            if (!val) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ UID'); input.focus(); return; }
            if (!/^[0-9]{9}$/.test(val)) { alert('UID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–æ–≤–Ω–æ 9 —Ü–∏—Ñ—Ä'); input.focus(); return; }
            </text>
        }
        else
        {
            <text>
            if (!val) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ Player ID'); input.focus(); return; }
            if (!/^[0-9]{5,12}$/.test(val)) { alert('Player ID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 5 –¥–æ 12 —Ü–∏—Ñ—Ä'); input.focus(); return; }
            </text>
        }

        if (!agree.checked) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–º–∏—Ç–µ —É—Å–ª–æ–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è');
            return;
        }

        if (!selectedProductId) { alert('–ü–æ–∫—É–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö'); return; }

        @if (!User.Identity?.IsAuthenticated ?? true)
        {
            <text>
            window.location.href = '/Account/Login?returnUrl=' + encodeURIComponent(window.location.pathname);
            return;
            </text>
        }

        // –°–æ–±–∏—Ä–∞–µ–º deliveryInfo
        let deliveryInfo = val;
        @if (isMobileLegends)
        {
            <text>
            const zoneInput2 = document.getElementById('modalZoneInput');
            deliveryInfo = val + ' / Zone: ' + zoneInput2.value.trim();
            </text>
        }

        const btn = document.querySelector('.modal-pay-button');
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> –û–±—Ä–∞–±–æ—Ç–∫–∞...';

        const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
        fetch('/Catalog/Purchase', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'RequestVerificationToken': token },
            body: JSON.stringify({ gameProductId: selectedProductId, deliveryInfo: deliveryInfo, paymentMethod: 'balance' })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                showPurchaseSuccess(data.orderNumber, data.productKey, data.newBalance);
            } else {
                alert(data.errorMessage || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ');
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-cart-check"></i> –û–ø–ª–∞—Ç–∏—Ç—å';
            }
        })
        .catch(() => {
            alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            btn.disabled = false;
            btn.innerHTML = '<i class="bi bi-cart-check"></i> –û–ø–ª–∞—Ç–∏—Ç—å';
        });
    }

    function showPurchaseSuccess(orderNumber, productKey, newBalance) {
        const modal = document.querySelector('.purchase-modal-body');
        modal.innerHTML = `
            <div style="text-align: center; padding: 2rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
                <h3 style="color: #22c55e; margin-bottom: 0.5rem;">–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</h3>
                <p style="color: rgba(255,255,255,0.6); margin-bottom: 1.5rem;">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: <code>${orderNumber}</code></p>
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                    <div style="color: rgba(255,255,255,0.5); font-size: 0.85rem; margin-bottom: 0.5rem;">–í–∞—à –∫–ª—é—á:</div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
                        <code style="font-size: 1.1rem; color: #667eea; word-break: break-all;">${productKey}</code>
                        <button onclick="navigator.clipboard.writeText('${productKey}');this.innerHTML='<i class=\\'bi bi-check\\'></i>'" style="background: rgba(255,255,255,0.1); border: none; color: white; padding: 0.3rem 0.5rem; border-radius: 6px; cursor: pointer;">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                </div>
                ${newBalance !== null ? '<p style="color: rgba(255,255,255,0.5); font-size: 0.85rem;">–ë–∞–ª–∞–Ω—Å: ' + Math.floor(newBalance).toLocaleString('ru-RU') + ' ‚ÇΩ</p>' : ''}
                <div style="display: flex; gap: 0.75rem; justify-content: center; margin-top: 1.5rem;">
                    <a href="/Account/Orders" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.6rem 1.5rem; border-radius: 10px; text-decoration: none; font-weight: 500;">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
                    <button onclick="closePurchaseModal();location.reload();" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 0.6rem 1.5rem; border-radius: 10px; cursor: pointer;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                </div>
            </div>`;
    }

    // Select first product by default
    document.addEventListener('DOMContentLoaded', function() {
        const firstItem = document.querySelector('.product-item');
        if (firstItem) {
            firstItem.click();
        }
    });

    // Filter games in sidebar
    function filterGames(query) {
        const games = document.querySelectorAll('.sidebar-game');
        const lowerQuery = query.toLowerCase();
        games.forEach(game => {
            const name = game.querySelector('.sidebar-game-name')?.textContent.toLowerCase() || '';
            const subtitle = game.querySelector('.sidebar-game-subtitle')?.textContent.toLowerCase() || '';
            if (name.includes(lowerQuery) || subtitle.includes(lowerQuery)) {
                game.style.display = 'flex';
            } else {
                game.style.display = 'none';
            }
        });
    }
</script>
}
